
<h1 class="sectionedit1" id="gitflow分支模式">Gitflow分支模式</h1>
<div class="level1">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-gitflow.png" class="media" title="git_branch_model:git-workflow-gitflow.png"><img src="/xueshell.com/0/lib/exe/fetch.php?w=300&amp;tok=91494f&amp;media=git_branch_model:git-workflow-gitflow.png" class="mediacenter" alt="" width="300" /></a>
The <a href="http://nvie.com/posts/a-successful-git-branching-model/" class="urlextern" title="http://nvie.com/posts/a-successful-git-branching-model/"  rel="nofollow">Gitflow Workflow</a> section below is derived from Vincent Driessen at nvie. 
</p>

<p>
<span style="color: #0000EE">Gitflow 围绕产品发布定义了一系列严格用途的的多任务分支模式。但比任务分支模式更复杂，但对于管理大型项目提供了强壮的框架。</span>
</p>

<p>
<span style="color: #0000EE">相对于任务分支，gitflow没有增加新的概念和命令，它只是赋予分支特定的角色，定义了分支之间什么时间和如何交互。 这些分支专门用来开发、维护、发布等功能。你也可以利用任务分支的所有其他好处，pull request、实验开发、有效协作等。</span>
</p>

</div>
<!-- EDIT1 SECTION "Gitflow分支模式" [1-765] -->
<h2 class="sectionedit2" id="流程描述">流程描述</h2>
<div class="level2">

<p>
<span style="color: #0000EE">Gitflow 依然使用一个中央仓库作为所有团队成员的官方项目库。而且同其他工作流程一样，开发者依然在本地开发，并提交分支到中央仓库。这种模式最大的不同是项目中的分支结构。</span>
</p>

</div>
<!-- EDIT2 SECTION "流程描述" [766-1053] -->
<h3 class="sectionedit3" id="产品历史分支_master_和_develop">产品历史分支(Master 和 Develop)</h3>
<div class="level3">

<p>
<span style="color: #0000EE">相对于项目库中的单个master分支，gitflows用两个分支来记录项目演变历史。 master分支记录项目的正式发布历史，开发分支记录功能集成迭代过程。按照产品的版本演进在master主分支上很便利贴上标签。</span>
</p>

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-1historical.png" class="media" title="git_branch_model:git-workflow-release-cycle-1historical.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-1historical.png" class="mediacenter" alt="" /></a>
The rest of this workflow revolves around the distinction between these two branches.
</p>

<p>
<span style="color: #0000EE">此工作流的其余部分围绕着这两个分支差异展开。</span>
</p>

</div>
<!-- EDIT3 SECTION "产品历史分支(Master 和 Develop)" [1054-1625] -->
<h3 class="sectionedit4" id="任务分支_feature_branch">任务分支(Feature Branch)</h3>
<div class="level3">

<p>
<span style="color: #0000EE">新功能的开发都在工程师本地分支上，最后要提交到中央项目仓库用于备份和协作开发。但是，其他分支模式都是从主干master开出分支，而gitflow中的任务分支是从开发分支(develop）上创建的。当任务完成后，任务分支合并回开发分支(develop).任务分支从不直接和主干(master）打交道。</span>
</p>

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-2feature.png" class="media" title="git_branch_model:git-workflow-release-cycle-2feature.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-2feature.png" class="mediacenter" alt="" /></a>
</p>

<p>
<span style="color: #0000EE">任务分支结合开发分支，就可以满足对于各种开发用途，gitflow还不止这些功能。</span>
</p>

</div>
<!-- EDIT4 SECTION "任务分支(Feature Branch)" [1626-2247] -->
<h3 class="sectionedit5" id="发布分支_release_branches">发布分支（Release Branches）</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-3release.png" class="media" title="git_branch_model:git-workflow-release-cycle-3release.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-3release.png" class="mediacenter" alt="" /></a>
</p>

<p>
<span style="color: #0000EE">当代码逐渐成熟，准备发布的时候。你就需要从开发分支上开出一个发布分支。这也就意味着你进入这一轮发布周期。在这以后，发布分支不接受新的功能代码的合并，只合并缺陷修复的代码，文档修改和其他面向发布的任务。如果准备发布，发布分支就合并到master主分支，并贴上产品版本标签。同时，发布分支也要合并回开发分支，因为发布分支建立来，一些紧急修复也要合并回开发分支. </span>
</p>

<p>
发布的准备过程使用一个专门的分支，便于团队专心致力发布前的工作，并不阻碍其他人同时进入下一个发布循环。这样也定义和规范了开发的不同阶段。比如说： 工程师很方便说“本周我们准备发布产品4.0”，而且在代码仓库里，我们也看到真实的行动。
</p>
<pre class="code">Common conventions:
惯例：

    branch off: develop
    merge into: master
    naming convention: release-* or release/*</pre>

</div>
<!-- EDIT5 SECTION "发布分支（Release Branches）" [2248-3382] -->
<h3 class="sectionedit6" id="维护分支_hot_fix_branch">维护分支（Hot Fix Branch）</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-4maintenance.png" class="media" title="git_branch_model:git-workflow-release-cycle-4maintenance.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-4maintenance.png" class="mediacenter" alt="" /></a>
</p>

<p>
<span style="color: #0000EE">维护分支，或者叫”hotfix”分支用于快速修补产品的安全类问题。这是唯一直接从master分支上开出的分支。一旦修复完成，代码应合并回master主干和develop分支（或者当前发布分支），master分支上也要贴一个标签。</span>
</p>

<p>
<span style="color: #0000EE">独立的维护分支的出现，可以让团队成员无需中断发布流程，或者必须等在下次发布修复缺陷。维护分支是直接从master分支上直接开出用于紧急修复的发布分支。 </span>
</p>

</div>
<!-- EDIT6 SECTION "维护分支（Hot Fix Branch）" [3383-4026] -->
<h2 class="sectionedit7" id="实例演示">实例演示</h2>
<div class="level2">

<p>
下面演示发布循环的一次过程。假设你已经有中央的官方项目库，
</p>

</div>
<!-- EDIT7 SECTION "实例演示" [4027-4139] -->
<h3 class="sectionedit8" id="创建开发分支">创建开发分支</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-5createdev.png" class="media" title="git_branch_model:git-workflow-release-cycle-5createdev.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-5createdev.png" class="mediacenter" alt="" /></a>
</p>

<p>
<span style="color: #0000EE">第一步，从master上创建开发分支(developt)。简单的方法是，某个工程师在本地从master上创建一个叫develop的分支，然后提交到中央项目仓库：</span>
</p>
<pre class="code">git branch develop
git push -u origin develop</pre>

<p>
This branch will contain the complete history of the project, whereas master will contain an abridged version. Other developers should now clone the central repository and create a tracking branch for develop:
</p>

<p>
<span style="color: #0000EE">这个分支包含了产品完整的历史路线，因为master主干包含产品的基线历史。接下来，团队成员克隆中央仓库，本地创建远程分支：</span>
</p>
<pre class="code">git clone ssh://user@host/path/to/repo.git
git checkout -b develop origin/develop</pre>

<p>
每个成员现在都有本地拷贝。   
</p>

</div>
<!-- EDIT8 SECTION "创建开发分支" [4140-5043] -->
<h3 class="sectionedit9" id="mary_和_john_开发新功能">Mary 和 John 开发新功能</h3>
<div class="level3">

<p>
 <a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-6maryjohnbeginnew.png" class="media" title="git_branch_model:git-workflow-release-cycle-6maryjohnbeginnew.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-6maryjohnbeginnew.png" class="mediacenter" alt="" /></a>
</p>

<p>
我们的例子中，John和Mary有不同的需求开发任务，他们本地创建各自的任务分支去完成需求。以往的分支模式都是从master上创建任务分支。然而gitflow模式却是从develop上创建任务分支：
</p>
<pre class="code">git checkout -b some-feature develop</pre>

<p>
他俩在各自的分支上例行步骤完成开发：编辑，缓存，提交：
</p>
<pre class="code">git status
git add &lt;some-file&gt;
git commit</pre>

</div>
<!-- EDIT9 SECTION "Mary 和 John 开发新功能" [5044-5596] -->
<h3 class="sectionedit10" id="mary_完成任务开发">Mary 完成任务开发</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-7maryfinishes.png" class="media" title="git_branch_model:git-workflow-release-cycle-7maryfinishes.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-7maryfinishes.png" class="mediacenter" alt="" /></a>
</p>

<p>
<span style="color: #0000EE">Mary完成了自己的需求开发任务。如果她的团队使用了pull request，这是合适的时机去发起pull requests 要求合并自己的代码进入develop分支。 如果团队没有使用 pull requests，她合并任务分支进入本地的开发分支，然后推送到远端中央项目库：</span>
</p>
<pre class="code">git pull origin develop
git checkout develop
git merge some-feature
git push
git branch -d some-feature</pre>

<p>
第一行命令确保本地develop分支和远端同步。注意的是任务分支不会直接合并入master，如何解决冲突和中央集中分支模式是一致的。
</p>

</div>
<!-- EDIT10 SECTION "Mary 完成任务开发" [5597-6325] -->
<h3 class="sectionedit11" id="mary开始计划发布产品">Mary开始计划发布产品</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-8maryprepsrelease.png" class="media" title="git_branch_model:git-workflow-release-cycle-8maryprepsrelease.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-8maryprepsrelease.png" class="mediacenter" alt="" /></a>
</p>

<p>
<span style="color: #0000EE">John还在继续开发他的代码，Mary已经开始准备她的项目第一次发布。她用一个新分支专门用来管理发布过程。这一步确立了产品的第一个版本号0.1：</span>
</p>
<pre class="code">git checkout -b release-0.1 develop</pre>

<p>
This branch is a place to clean up the release, test everything, update the documentation, and do any other kind of preparation for the upcoming release. It’s like a feature branch dedicated to polishing the release.
</p>

<p>
As soon as Mary creates this branch and pushes it to the central repository, the release is feature-frozen. Any functionality that isn’t already in develop is postponed until the next release cycle.
</p>

</div>
<!-- EDIT11 SECTION "Mary开始计划发布产品" [6326-7126] -->
<h3 class="sectionedit12" id="mary_完成发布">Mary 完成发布</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-release-cycle-9maryfinishes.png" class="media" title="git_branch_model:git-workflow-release-cycle-9maryfinishes.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-release-cycle-9maryfinishes.png" class="mediacenter" alt="" /></a>
Once the release is ready to ship, Mary merges it into master and develop, then deletes the release branch. It’s important to merge back into develop because critical updates may have been added to the release branch and they need to be accessible to new features. Again, if Mary’s organization stresses code review, this would be an ideal place for a pull request.
</p>

<p>
<span style="color: #0000EE">

一旦产品发布准备完毕，Mary合并发布分支到主干分支（master）和开发分支（develop），然后删除发布分支。发布分支合并回开发分支很关键。如果mary的团队强调代码评审，这时发起pull request 是个好时机。</span>
</p>
<pre class="code">git checkout master
git merge release-0.1
git push
git checkout develop
git merge release-0.1
git push
git branch -d release-0.1</pre>

<p>
Release branches act as a buffer between feature development (develop) and public releases (master). Whenever you merge something into master, you should tag the commit for easy reference:
</p>

<p>
<span style="color: #0000EE">
发布分支扮演了缓存在任务任务分支（deveop）和主发布分支（master）。合并进入master分支，都需要追加标签便于参考：
</span>
</p>
<pre class="code">git tag -a 0.1 -m &quot;Initial public release&quot; master
git push --tags</pre>

<p>
Git comes with several hooks, which are scripts that execute whenever a particular event occurs within a repository. It’s possible to configure a hook to automatically build a public release whenever you push the master branch to the central repository or push a tag.
</p>

</div>
<!-- EDIT12 SECTION "Mary 完成发布" [7127-8746] -->
<h3 class="sectionedit13" id="用户发现bug">用户发现bug</h3>
<div class="level3">

<p>
<a href="/xueshell.com/0/lib/exe/detail.php?id=git_branch_model%3Agit-workflow-gitflow&amp;media=git_branch_model:git-workflow-gitflow-enduserbug.png" class="media" title="git_branch_model:git-workflow-gitflow-enduserbug.png"><img src="/xueshell.com/0/lib/exe/fetch.php?media=git_branch_model:git-workflow-gitflow-enduserbug.png" class="mediacenter" alt="" /></a>
</p>

<p>
After shipping the release, Mary goes back to developing features for the next release with John. That is, until an end-user opens a ticket complaining about a bug in the current release. To address the bug, Mary (or John) creates a maintenance branch off of master, fixes the issue with as many commits as necessary, then merges it directly back into master.
</p>

<p>
<span style="color: #0000EE">产品发布后，Mary返回继续开发新的任务，为下次发布准备。如果用户报告了缺陷，需要从master创建维护分支，修复问题后，直接合并回master分支。</span>
</p>
<pre class="code">git checkout -b issue-#001 master
# Fix the bug
git checkout master
git merge issue-#001
git push</pre>

<p>
Like release branches, maintenance branches contain important updates that need to be included in develop, so Mary needs to perform that merge as well. Then, she’s free to delete the branch:
</p>

<p>
<span style="color: #0000EE">就像发布分支，维护分支包含了重要的代码修复，同样需要合并回开发分支，所有Mary需要执行合并，完事后，删除任务维护分支。</span>
</p>
<pre class="code">git checkout develop
git merge issue-#001
git push
git branch -d issue-#001</pre>

</div>
<!-- EDIT13 SECTION "用户发现bug" [8747-9995] -->
<h2 class="sectionedit14" id="where_to_go_from_here">Where To Go From Here</h2>
<div class="level2">

<p>
By now, you’re hopefully quite comfortable with the Centralized Workflow, the Feature Branch Workflow, and the Gitflow Workflow. You should also have a solid grasp on the potential of local repositories, the push/pull pattern, and Git&#039;s robust branching and merging model.
</p>

<p>
Remember that the workflows presented here are merely examples of what’s possible—they are not hard-and-fast rules for using Git in the workplace. So, don&#039;t be afraid to adopt some aspects of a workflow and disregard others. The goal should always be to make Git work for you, not the other way around.
</p>

</div>
<!-- EDIT14 SECTION "Where To Go From Here" [9996-] -->